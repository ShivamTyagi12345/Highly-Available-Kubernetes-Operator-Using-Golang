--- 
jobs: 
  build: 
    name: "Build and Test Go Application"
    runs-on: ubuntu-latest
    steps: 
      - 
        name: "Setup Go 1.16"
        uses: actions/setup-go@v2
        with: 
          go-version: "1.16.3"
      - 
        name: "Checkout Source Code"
        uses: actions/checkout@v2
      - 
        env: 
          GOPROXY: "https://proxy.golang.org"
        name: Build
        run: "go build -v ./..."
      - 
        name: "Test Cases"
        run: "go test -v ./..."
      - 
        name: "Check go vet"
        run: "go vet ./..."
      - 
        name: "Check Formatting using go fmt"
        run: |
            gofmt -s -l .
                      
            if [ "$(gofmt -s -l . | wc -l)" -gt 0 ]; then exit 1; fi
      - 
        name: "Run go lint"
        run: |
            curl -sSfL https://raw.githubusercontent.com/golangci/golangci-lint/master/install.sh | sh -s -- -b $(go env GOPATH)/bin v1.26.0
            
            golangci-lint run
  notify: 
    if: "${{ github.base_ref == 'main' && github.event_name == 'pull_request' }}"
    name: "Notify on Slack"
    needs: 
      - build
    runs-on: ubuntu-latest
    steps: 
      - 
        env: 
          SLACK_AUTH_TOKEN: "${{ secrets.SLACK_AUTH_TOKEN }}"
        if: success()
        uses: abinoda/slack-action@master
        with: 
          args: "{\\\"channel\\\":\\\"${{ secrets.SLACK_CHANNEL_ID }}\\\",\\\"blocks\\\":[{\\\"type\\\":\\\"section\\\",\\\"text\\\":{\\\"type\\\":\\\"mrkdwn\\\",\\\"text\\\":\\\"*Pull Request:* ${{ github.event.pull_request.title }}\\\"}},{\\\"type\\\":\\\"section\\\",\\\"text\\\":{\\\"type\\\":\\\"mrkdwn\\\",\\\"text\\\":\\\"*Contributor :* ${{ github.event.pull_request.user.login }}\\n*Request State:* ${{ github.event.pull_request.state }}\\\"}},{\\\"type\\\":\\\"section\\\",\\\"text\\\":{\\\"type\\\":\\\"mrkdwn\\\",\\\"text\\\":\\\"<${{ github.event.pull_request.html_url }}|View Pull Request>\\\"}}]}"
name: "Build and Test Go Application"
true: 
  pull_request: 
    branches: 
      - main
  push: 
    branches: 
      - "**"
